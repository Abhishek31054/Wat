<!DOCTYPE html>
<html>
<head>
  <title>Water Level Monitor</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // Firebase config (replace with your values)
    const firebaseConfig = {
      apiKey: "AIzaSyA1ARR3AbTpPXZ5YD4yY9RvgDAFtux5OzY",
      authDomain: "water-level-3c52a.firebaseapp.com",
      databaseURL: "https://water-level-3c52a-default-rtdb.firebaseio.com",
      projectId: "water-level-3c52a",
      storageBucket: "water-level-3c52a.firebasestorage.app",
      messagingSenderId: "975946187055",
      appId: "1:975946187055:web:e3914a13661bfc08cc21da",
      measurementId: "G-PXKHH32NY0"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Water level %
    const levelRef = ref(db, "/water/percent");
    onValue(levelRef, (snapshot) => {
      document.getElementById("level").innerText = snapshot.val() + " %";
    });

    // Motor state
    const motorRef = ref(db, "/motor/state");
    onValue(motorRef, (snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("motor").innerText = snapshot.val() == 1 ? "ON" : "OFF";
      }
    });

    // Dry run status
    const dryRunRef = ref(db, "/dryRun");
    onValue(dryRunRef, (snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("dryrun").innerText = snapshot.val();
      }
    });

    // Sensors
    ["20","40","60","80","100"].forEach(level => {
      const sensorRef = ref(db, "/water/sensors/" + level);
      onValue(sensorRef, (snapshot) => {
        let el = document.getElementById("s" + level);
        if (snapshot.exists() && snapshot.val() === "ON") {
          el.className = "sensor on";
        } else {
          el.className = "sensor off";
        }
      });
    });

    // Motor control
    window.setMotor = function(state) {
      set(ref(db, "/control/manual"), true);
      set(ref(db, "/control/motor_set"), state);
    };
  </script>
  <style>
    body { font-family: Arial, sans-serif; }
    .sensor { margin: 5px; padding: 10px; display: inline-block; border-radius: 8px; width: 60px; text-align: center; }
    .on  { background-color: #4CAF50; color: white; }
    .off { background-color: #f44336; color: white; }
  </style>
</head>
<body>
  <h2>ðŸ’§ Water Level Monitoring</h2>
  <p>Water Level: <span id="level">--</span></p>
  <p>Motor: <span id="motor">--</span></p>
  <p>Dry Run: <span id="dryrun">--</span></p>

  <h3>Sensor Levels</h3>
  <div id="s20" class="sensor off">20%</div>
  <div id="s40" class="sensor off">40%</div>
  <div id="s60" class="sensor off">60%</div>
  <div id="s80" class="sensor off">80%</div>
  <div id="s100" class="sensor off">100%</div>

  <h3>Motor Control</h3>
  <button onclick="setMotor(1)">Motor ON</button>
  <button onclick="setMotor(0)">Motor OFF</button>
</body>
</html>
